{"version":3,"sources":["components/svg.js","components/multiSelect.js","components/localAuthority.js","components/dates.js","components/siteOfLoan.js","helper/selectAllClick.js","helper/unpack.js","helper/wrap.js","helper/tooltip.js","helper/draw.js","helper/fixSelectedSites.js","helper/getSites.js","helper/getDates.js","components/chart.js","App.js","serviceWorker.js","helper/getSummed.js","index.js","data/issues.csv"],"names":["id","createOptions","label","value","options","className","defaultValue","onChange","placeholderButtonLabel","opts","map","s","LocalAuthority","Dates","dates","SiteOfLoan","selectAllClick","arr","values","x","indexOf","length","splice","shift","fixDups","siteOfLoans","o","Set","forEach","site","dups","filter","i","arrayIndex","unpack","d","filt","localAuthorities","res","la","LAindex","date","datesIndex","data","includes","push","wrap","text","width","words","split","reverse","word","line","lineNumber","y","attr","dy","slice","fontSize","tspan","append","pop","join","node","getComputedTextLength","fontSizeFix","selectAll","style","tip","d3Tip","html","keys","Object","key","v","val","tipHtml","draw","d3","remove","margin","height","colours","range","domain","padding","xWidth","bandwidth","Issues","chart","call","enter","on","show","hide","xAxis","each","this","classed","str","fix","fixedSites","fixSelectedSites","LAs","dataLAs","Chart","initLA","initDates","getDates","useState","setOptions","useEffect","selected","newOptions","selectedDates","getSites","selectedSites","Title","App","Boolean","window","location","hostname","match","concatDates","sumAll","a","nest","rollup","sum","entries","p","q","csv","issues","init","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.c56d673e.chunk.js","sourcesContent":["import React from 'react'\n\nexport default ({id}) => (\n  <svg id={id}></svg>\n)","// import React from \"react\";\n\n// const Option = ({ children }) => <option>{children}</option>;\n\n// export default ({ options, id, multiple }) => (\n//   <div className=\"pure-form\">\n//     <select id={id} className=\"pure-input-1-2 select\" multiple={multiple}>\n//       {options.map(option => (\n//         <Option key={option}>{option}</Option>\n//       ))}\n//     </select>\n//   </div>\n// );\nimport React from \"react\";\nimport ReactMultiSelectCheckboxes from \"react-multiselect-checkboxes\";\n\nconst createOptions = (label, value) => {\n  return { label, value };\n};\n\nexport default ({\n  options,\n  id,\n  className,\n  defaultValue,\n  onChange,\n  placeholderButtonLabel\n}) => {\n  const opts = options.map(s => createOptions(s, s));\n\n  return (\n    <div className={className}>\n      <ReactMultiSelectCheckboxes\n        options={opts}\n        defaultValue={createOptions(defaultValue, defaultValue)}\n        onChange={onChange}\n        placeholderButtonLabel={placeholderButtonLabel}\n      />\n    </div>\n  );\n};\n","import React from 'react';\nimport MultiSelect from './multiSelect';\n\nconst LocalAuthority = ({ options, onChange }) => (\n  <MultiSelect\n    options={options}\n    className=\"select-wrapper\"\n    defaultValue={options[0]}\n    placeholderButtonLabel={\"Local authority\"}\n    onChange={onChange}\n  />\n);\n\nexport default LocalAuthority;","import React from \"react\";\nimport MultiSelect from \"./multiSelect\";\n\nconst Dates = ({ dates, onChange }) => {\n  return (\n    <MultiSelect\n      options={dates}\n      className=\"select-wrapper\"\n      defaultValue={dates[0]}\n      placeholderButtonLabel={\"Date Range\"}\n      onChange={onChange}\n    />\n  );\n};\n\nexport default Dates;\n","import React from \"react\";\nimport MultiSelect from \"./multiSelect\";\n\nconst SiteOfLoan = ({ options, onChange }) => (\n  <MultiSelect\n    options={options}\n    className=\"select-wrapper\"\n    defaultValue={options[0]}\n    placeholderButtonLabel={\"Site of Loan\"}\n    onChange={onChange}\n  />\n);\n\nexport default SiteOfLoan;\n","function selectAllClick(arr) {\n  const values = arr.map(x => x.value);\n  if (values.indexOf(\"All\") === 0 && arr.length > 1) {\n    arr.splice(0, 1);\n  } else if (values.indexOf(\"All\") === arr.length - 1) {\n    while (arr.length > 1) {\n      arr.shift();\n    }\n  }\n  return arr;\n}\n\nexport default selectAllClick\n","const fixDups = arr => {\n  const siteOfLoans = arr.map(o => o[\"Site of loan\"]);\n  const unique = [...new Set(siteOfLoans)];\n  unique.forEach(site => {\n    const dups = siteOfLoans.filter(x => x === site).length;\n    if (dups > 1) {\n      for (let i = 0; i < dups; i++) {\n        const currSites = arr.map(o => o[\"Site of loan\"]);\n        const arrayIndex = currSites.indexOf(site);\n        arr[arrayIndex][\"Site of loan\"] = `${site} (${i + 1})`;\n      }\n    }\n  });\n  return arr;\n};\n\nfunction unpack(d, options, filt=false) {\n  const { localAuthorities, dates, siteOfLoans } = options;\n  let res = [];\n  localAuthorities.forEach(la => {\n    const LAindex = d.map(o => o[\"Local authority\"]).indexOf(la);\n    dates.forEach(date => {\n      const datesIndex = d[LAindex].values.map(o => o.Dates).indexOf(date);\n      const siteFilter = o => {\n        return (\n          siteOfLoans.includes(o[\"Site of loan\"]) || siteOfLoans.includes(\"All\")\n        );\n      };\n      const data = filt\n        ? d[LAindex].values[datesIndex].values.map(o => {\n            return { ...o, Dates: date, \"Local authority\": la };\n          })\n        : d[LAindex].values[datesIndex].values.filter(siteFilter).map(o => {\n            return { ...o, Dates: date, \"Local authority\": la };\n          });\n      res.push(...data);\n    });\n  });\n  return fixDups(res);\n}\n\nexport default unpack;\n","import { selectAll } from \"d3-selection\";\n\nfunction wrap(text, width) {\n  const words = text\n    .text()\n    .split(/\\s+/)\n    .reverse();\n  let word = \"\";\n  let line = [];\n  let lineNumber = 0;\n  const lineHeight = 1.1; // ems\n  const y = text.attr(\"y\");\n  const dy = +text.attr(\"dy\").slice(0, -3);\n  let fontSize = 1;\n  let tspan = text\n    .text(null)\n    .append(\"tspan\")\n    .attr(\"x\", 0)\n    .attr(\"y\", y)\n    .attr(\"dy\", dy + \"em\");\n  while ((word = words.pop())) {\n    line.push(word);\n    tspan.text(line.join(\" \"));\n    if (tspan.node().getComputedTextLength() > width) {\n      line.pop();\n      tspan.text(line.join(\" \"));\n      line = [word];\n      tspan = text\n        .append(\"tspan\")\n        .attr(\"x\", 0)\n        .attr(\"y\", y)\n        .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n        .text(word);\n      function fontSizeFix() {\n        if (tspan.node().getComputedTextLength() > width) {\n          fontSize = 0.99 * fontSize;\n          selectAll(\".x-axis-text\").style(\"font-size\", `${fontSize}em`);\n          fontSizeFix();\n        } else {\n          return;\n        }\n      }\n      fontSizeFix();\n    }\n  }\n}\n\nexport default wrap;\n","import d3Tip from \"d3-tip\";\n\nconst html = (k, v) => {\n\treturn `<p class='tt'>${k}: ${v}</p>`;\n};\n\nconst tipHtml = d => {\n\tconst keys = Object.keys(d);\n\tlet res = \"\";\n\tkeys.forEach(key => {\n\t\tconst val = d[key];\n\t\tres += html(key, val);\n\t});\n\treturn res;\n};\n\nconst tip = d3Tip()\n\t.attr(\"class\", \"d3-tip\")\n\t.html(d => {\n\t\tconst res = tipHtml(d);\n\t\treturn res;\n\t});\n\nexport default tip;\n","import * as d3 from \"d3\";\nimport unpack from \"./unpack\";\nimport wrap from \"./wrap\";\nimport tip from \"./tooltip\";\n\nfunction draw(d, options) {\n  const data = unpack(d, options);\n  d3.select(\"#chart\")\n    .selectAll(\"*\")\n    .remove();\n\n  const margin = { top: 40, right: 10, bottom: 90, left: 70 };\n  const width = 1000 - margin.left - margin.right;\n  const height = 600 - margin.top - margin.bottom;\n  const colours = d3.schemeCategory10;\n\n  const x = d3\n    .scaleBand()\n    .range([0, width])\n    .domain(data.map(o => o[\"Site of loan\"]))\n    .padding(0.1);\n\n  const xWidth = x.bandwidth();\n\n  const y = d3\n    .scaleLinear()\n    .range([height, 0])\n    .domain([0, d3.max(data.map(o => o.Issues))]);\n\n  const chart = d3\n    .select(\"#chart\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left}, ${margin.top})`);\n\n  chart.call(tip);\n\n  chart\n    .selectAll(\".bar\")\n    .data(data)\n    .enter()\n    .append(\"rect\")\n    .attr(\"class\", \"bar\")\n    .attr(\"x\", d => x(d[\"Site of loan\"]))\n    .attr(\"width\", xWidth)\n    .attr(\"y\", d => y(d.Issues))\n    .attr(\"height\", d => height - y(d.Issues))\n    .style(\"fill\", (d, i) => colours[i % colours.length])\n    .on(\"mouseover\", tip.show)\n    .on(\"mouseout\", tip.hide);\n\n  const xAxis = d3.axisBottom(x); //.tickValues(data.map(o => o[\"Site of loan\"]));\n\n  chart\n    .append(\"g\")\n    .attr(\"transform\", `translate(0, ${height})`)\n    .call(xAxis)\n    .each(function() {\n      d3.select(this)\n        .selectAll(\".tick text\")\n        .classed('x-axis-text', true)\n        .each(function() {\n          wrap(d3.select(this), xWidth);\n        });\n    });\n\n  chart.append(\"g\").call(d3.axisLeft(y));\n\n  chart\n    .append(\"text\")\n    .attr(\"class\", \"legend\")\n    .attr(\n      \"transform\",\n      `translate(${width / 2}, ${height + margin.bottom - 20})`\n    )\n    .attr(\"alignment-baseline\", \"middle\")\n    .style(\"text-anchor\", \"middle\")\n    .text(\"Site of loan\");\n\n  chart\n    .append(\"text\")\n    .attr(\"class\", \"legend\")\n    .attr(\"transform\", \"rotate(-90)\")\n    .attr(\"y\", 0 - margin.left + 5)\n    .attr(\"x\", 0 - height / 2)\n    .attr(\"dy\", \"1em\")\n    .style(\"text-anchor\", \"middle\")\n    .text(\"Loans + renewals in a timeframe\");\n\n  chart\n    .append(\"text\")\n    .attr(\"class\", \"chart-title\")\n    .attr(\"y\", 0-0.25*margin.top)\n    .attr(\"x\", width / 2)\n    .style(\"text-anchor\", \"middle\")\n    .text(\"Issues + Renewals by Loan Site\");\n  \n  // const ticktext = d3.selectAll('.tick text').each(function(){\n  //   const text = d3.select(this);\n  //   debugger;\n  // })\n  // const tspans = d3.selectAll('.tick text tspan')\n  // debugger;\n}\n\nexport default draw;\n","export default arr => {\n\tconst fix = str => {\n\t\tconst i = str.indexOf(\"(\");\n\t\tif (i === -1) {\n\t\t\treturn str;\n\t\t} else {\n\t\t\treturn str.slice(0, i - 1);\n\t\t}\n\t};\n\n\treturn arr.map(x => fix(x));\n};\n","import unpack from \"./unpack\";\nimport fixSelectedSites from './fixSelectedSites'\n\nexport default (d, options) => {\n\tconst data = unpack(d, options, true);\n\tconst siteOfLoans = data.map(o => o[\"Site of loan\"]);\n\tconst fixedSites = fixSelectedSites(siteOfLoans);\n\tconst res = ['All', ...new Set(fixedSites)];\n\treturn res;\n};\n","export default (data, LAs) => {\n  let res = [];\n  const dataLAs = data.map(o => o[\"Local authority\"]);\n  for (let i = 0; i < LAs.length; i++) {\n    const la = LAs[i];\n    const target = data[dataLAs.indexOf(la)];\n    target.values.forEach(o => res.push(o.Dates));\n  }\n  return res;\n};\n","import React, { useState, useEffect } from \"react\";\nimport Svg from \"./svg\";\nimport LocalAuthority from \"./localAuthority\";\nimport Dates from \"./dates\";\nimport SiteOfLoan from \"./siteOfLoan\";\nimport selectAllClick from \"../helper/selectAllClick\";\nimport draw from \"../helper/draw\";\nimport getSites from \"../helper/getSites\";\nimport getDates from \"../helper/getDates\";\nimport fixSelectedSites from \"../helper/fixSelectedSites\";\nimport \"../style/chart.css\";\n\n// Columns on csv\n// Local authority,\n// Site of loan,\n// Count start,\n// Count end,\n// Type,\n// Book,\n// Issues\n\nconst Chart = ({ data }) => {\n  const LAs = data.map(o => o[\"Local authority\"]);\n  const initLA = LAs[0];\n  const initDatesArr = getDates(data, [initLA]);\n  const initDates = initDatesArr[0];\n  const [options, setOptions] = useState({\n    localAuthorities: [initLA],\n    dates: [initDates],\n    siteOfLoans: [\"All\"]\n  });\n\n  useEffect(() => {\n    draw(data, options);\n  });\n\n  const handleLAChange = arr => {\n    const selected = arr.map(x => x.value);\n    const newOptions = {\n      localAuthorities: selected,\n      dates: [getDates(data, selected)[0]],\n      siteOfLoans: options.siteOfLoans\n    };\n    setOptions(newOptions);\n    draw(data, newOptions);\n  };\n\n  const handleDateChange = arr => {\n    const selectedDates = arr.map(x => x.value);\n    const newOptions = {\n      ...options,\n      dates: selectedDates\n    };\n    setOptions(newOptions);\n    draw(data, newOptions);\n  };\n\n  const handleSitesChange = arr => {\n    const selectedSites = selectAllClick(arr).map(x => x.value);\n    const newOptions = options;\n    newOptions.siteOfLoans = fixSelectedSites(selectedSites);\n    setOptions(newOptions);\n    draw(data, newOptions);\n  };\n\n  return (\n    <div>\n      <div className=\"filter-wrapper\">\n        <LocalAuthority options={LAs} onChange={handleLAChange} />\n        <Dates\n          dates={getDates(data, options.localAuthorities)}\n          onChange={handleDateChange}\n        />\n        <SiteOfLoan\n          options={getSites(data, options)}\n          onChange={handleSitesChange}\n        />\n      </div>\n      <div className=\"chart-wrapper\">\n        <Svg id=\"chart\" />\n      </div>\n    </div>\n  );\n};\n\nexport default Chart;\n","import React, { Fragment } from \"react\";\nimport Chart from \"./components/chart\";\nimport \"./style/title.css\";\nimport \"./style/d3-tip.css\";\n\nconst Title = () => (\n  <header>\n    <h1>UK Library Issues</h1>\n  </header>\n);\n\nconst App = ({ data }) => {\n  return (\n    <Fragment>\n      <Title />\n      <main>\n        <Chart data={data} />\n      </main>\n    </Fragment>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { nest, sum } from \"d3\";\n\n// Data object keys from csv\n// Local authority,\n// Site of loan,\n// Count start,\n// Count end,\n// Type,\n// Book,\n// Issues\n\nconst concatDates = o => o[\"Count start\"] + \" - \" + o[\"Count end\"];\n\nconst sumAll = a => {\n  let arr = []\n  for(let i=0;i<a.length;i++){\n    const o = a[i];\n    const dates = concatDates(o)\n    o.Dates = dates\n    arr.push(o)\n  }\n  return nest()\n    .key(d => d[\"Local authority\"])\n    .key(d => d[\"Dates\"])\n    .key(d => d[\"Site of loan\"])\n    .rollup(d => sum(d.map(o => o[\"Issues\"])))\n    .entries(arr)\n    .map(o => {\n      return {\n        \"Local authority\": o.key,\n        values: o.values.map(p => {\n          return {\n            Dates: p.key,\n            values: p.values.map(q => {\n              return { 'Site of loan': q.key, 'Issues': q.value };\n            })\n          };\n        })\n      };\n    });\n};\n\nexport default sumAll;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport issues from \"./data/issues.csv\";\nimport { csv } from \"d3-fetch\";\nimport 'purecss'\nimport sumAll from './helper/getSummed'\n\nconst render = async () => {\n  const init = await csv(issues);\n  const data = sumAll(init);\n  ReactDOM.render(<App data={data} />, document.getElementById(\"root\"));\n};\n\nrender();\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/issues.b44bac97.csv\";"],"sourceRoot":""}